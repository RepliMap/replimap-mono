# ElastiCache Cluster: {{ resource.original_name }}
resource "aws_elasticache_cluster" "{{ resource.terraform_name }}" {
  cluster_id           = "{{ resource.config.cluster_id }}"
  engine               = "{{ resource.config.engine }}"
{% if resource.config.engine_version %}
  engine_version       = "{{ resource.config.engine_version }}"
{% endif %}
  node_type            = "{{ resource.config.node_type }}"
  num_cache_nodes      = {{ resource.config.num_cache_nodes }}
{% if resource.config.port %}
  port                 = {{ resource.config.port }}
{% endif %}

{% if resource.config.cache_subnet_group_name %}
  subnet_group_name = aws_elasticache_subnet_group.{{ resource.config.cache_subnet_group_name | terraform_name }}.name
{% endif %}

{% if resource.config.security_group_ids %}
  security_group_ids = [
{% for sg_id in resource.config.security_group_ids %}
    aws_security_group.{{ sg_id | terraform_name }}.id,
{% endfor %}
  ]
{% endif %}

{% if resource.config.parameter_group_name %}
  parameter_group_name = "{{ resource.config.parameter_group_name }}"
{% endif %}

{% if resource.config.maintenance_window %}
  maintenance_window = "{{ resource.config.maintenance_window }}"
{% endif %}

{% if resource.config.snapshot_retention_limit %}
  snapshot_retention_limit = {{ resource.config.snapshot_retention_limit }}
{% endif %}

  tags = {
    Name        = "{{ resource.original_name }}"
    Environment = var.environment
    ManagedBy   = "RepliMap"
  }
}
