# Target Group: {{ resource.original_name }}
resource "aws_lb_target_group" "{{ resource.terraform_name }}" {
  name        = "{{ resource.config.name }}"
  port        = {{ resource.config.port }}
  protocol    = "{{ resource.config.protocol }}"
  vpc_id      = aws_vpc.{{ resource.config.vpc_id | terraform_name }}.id
  target_type = "{{ resource.config.target_type | default('instance') }}"

  health_check {
    enabled             = {{ resource.config.health_check.enabled | lower }}
    path                = "{{ resource.config.health_check.path | default('/') }}"
    port                = "{{ resource.config.health_check.port | default('traffic-port') }}"
    protocol            = "{{ resource.config.health_check.protocol | default('HTTP') }}"
    healthy_threshold   = {{ resource.config.health_check.healthy_threshold | default(3) }}
    unhealthy_threshold = {{ resource.config.health_check.unhealthy_threshold | default(3) }}
    timeout             = {{ resource.config.health_check.timeout_seconds | default(5) }}
    interval            = {{ resource.config.health_check.interval_seconds | default(30) }}
{% if resource.config.health_check.matcher %}
    matcher             = "{{ resource.config.health_check.matcher.HttpCode | default('200') }}"
{% endif %}
  }

  tags = {
    Name        = "{{ resource.original_name }}"
    Environment = var.environment
    ManagedBy   = "RepliMap"
  }
}
